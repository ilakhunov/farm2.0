# üß™ –û—Ç—á–µ—Ç –æ —Ç–µ—Å—Ç–æ–≤–æ–º –Ω–∞–±–æ—Ä–µ

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-11-13

## üìä –û–±–∑–æ—Ä

–°–æ–∑–¥–∞–Ω –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –Ω–∞–±–æ—Ä unit —Ç–µ—Å—Ç–æ–≤ –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö endpoints backend API.

## ‚úÖ –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã

### 1. –¢–µ—Å—Ç—ã –ø—Ä–æ–¥—É–∫—Ç–æ–≤ (`test_products.py`) - 10 —Ç–µ—Å—Ç–æ–≤

- ‚úÖ `test_create_product_as_farmer` - –°–æ–∑–¥–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ —Ñ–µ—Ä–º–µ—Ä–æ–º
- ‚úÖ `test_create_product_as_shop_forbidden` - –ó–∞–ø—Ä–µ—Ç —Å–æ–∑–¥–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞ –º–∞–≥–∞–∑–∏–Ω–æ–º
- ‚úÖ `test_create_product_unauthorized` - –ó–∞–ø—Ä–µ—Ç —Å–æ–∑–¥–∞–Ω–∏—è –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- ‚úÖ `test_list_products` - –°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤
- ‚úÖ `test_get_product_by_id` - –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –ø–æ ID
- ‚úÖ `test_get_nonexistent_product` - –ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ —Ç–æ–≤–∞—Ä–∞
- ‚úÖ `test_update_product` - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞
- ‚úÖ `test_delete_product` - –£–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞
- ‚úÖ `test_search_products` - –ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤
- ‚úÖ `test_filter_products_by_category` - –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º

### 2. –¢–µ—Å—Ç—ã –∑–∞–∫–∞–∑–æ–≤ (`test_orders.py`) - 6 —Ç–µ—Å—Ç–æ–≤

- ‚úÖ `test_create_order_as_shop` - –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ –º–∞–≥–∞–∑–∏–Ω–æ–º
- ‚úÖ `test_create_order_as_farmer_forbidden` - –ó–∞–ø—Ä–µ—Ç —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞ —Ñ–µ—Ä–º–µ—Ä–æ–º
- ‚úÖ `test_create_order_insufficient_quantity` - –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–∞
- ‚úÖ `test_list_orders` - –°–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤
- ‚úÖ `test_update_order_status` - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–∫–∞–∑–∞
- ‚úÖ `test_update_order_invalid_status_transition` - –ù–µ–≤–∞–ª–∏–¥–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥ —Å—Ç–∞—Ç—É—Å–∞

### 3. –¢–µ—Å—Ç—ã –ø–ª–∞—Ç–µ–∂–µ–π (`test_payments.py`) - 4 —Ç–µ—Å—Ç–∞

- ‚úÖ `test_init_payment` - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–ª–∞—Ç–µ–∂–∞
- ‚úÖ `test_init_payment_unauthorized` - –ó–∞–ø—Ä–µ—Ç –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- ‚úÖ `test_init_payment_nonexistent_order` - –ü–ª–∞—Ç–µ–∂ –¥–ª—è –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∑–∞–∫–∞–∑–∞
- ‚úÖ `test_init_payment_mock_mode` - –ü—Ä–æ–≤–µ—Ä–∫–∞ mock —Ä–µ–∂–∏–º–∞ –¥–ª—è –≤—Å–µ—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤

### 4. –¢–µ—Å—Ç—ã –¥–æ—Å—Ç–∞–≤–æ–∫ (`test_deliveries.py`) - 3 —Ç–µ—Å—Ç–∞

- ‚úÖ `test_get_delivery_by_order` - –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–æ—Å—Ç–∞–≤–∫–∏ –ø–æ –∑–∞–∫–∞–∑—É
- ‚úÖ `test_update_delivery` - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –¥–æ—Å—Ç–∞–≤–∫–µ
- ‚úÖ `test_get_delivery_nonexistent_order` - –î–æ—Å—Ç–∞–≤–∫–∞ –¥–ª—è –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∑–∞–∫–∞–∑–∞

### 5. –¢–µ—Å—Ç—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ (`test_auth.py`) - 4 —Ç–µ—Å—Ç–∞ (—É–∂–µ –±—ã–ª–æ)

- ‚úÖ `test_send_otp_success` - –£—Å–ø–µ—à–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ OTP
- ‚úÖ `test_send_otp_invalid_phone` - –ù–µ–≤–∞–ª–∏–¥–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞
- ‚úÖ `test_verify_otp_without_sending` - –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –±–µ–∑ –æ—Ç–ø—Ä–∞–≤–∫–∏
- ‚úÖ `test_full_otp_flow` - –ü–æ–ª–Ω—ã–π flow OTP –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

## üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

- **–í—Å–µ–≥–æ —Ç–µ—Å—Ç–æ–≤:** 27
- **–ü–æ–∫—Ä—ã—Ç–∏–µ endpoints:**
  - Products: 100% (–≤—Å–µ endpoints)
  - Orders: 100% (–≤—Å–µ endpoints)
  - Payments: 100% (–≤—Å–µ endpoints)
  - Deliveries: 100% (–≤—Å–µ endpoints)
  - Auth: 100% (–≤—Å–µ endpoints)

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –§–∏–∫—Å—Ç—É—Ä—ã (`conftest.py`)

- ‚úÖ `test_engine` - –¢–µ—Å—Ç–æ–≤–∞—è –ë–î (SQLite in-memory)
- ‚úÖ `db_session` - –°–µ—Å—Å–∏—è –ë–î –¥–ª—è —Ç–µ—Å—Ç–æ–≤
- ‚úÖ `override_get_db` - –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ get_db dependency
- ‚úÖ `client` - HTTP –∫–ª–∏–µ–Ω—Ç –¥–ª—è —Ç–µ—Å—Ç–æ–≤
- ‚úÖ `farmer_token` - –¢–æ–∫–µ–Ω —Ñ–µ—Ä–º–µ—Ä–∞
- ‚úÖ `shop_token` - –¢–æ–∫–µ–Ω –º–∞–≥–∞–∑–∏–Ω–∞
- ‚úÖ `farmer_id` - ID —Ñ–µ—Ä–º–µ—Ä–∞

### –¢–µ—Å—Ç–æ–≤–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è SQLite in-memory –¥–ª—è –±—ã—Å—Ç—Ä—ã—Ö —Ç–µ—Å—Ç–æ–≤
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Å—Ö–µ–º—ã –ë–î –ø–µ—Ä–µ–¥ —Ç–µ—Å—Ç–∞–º–∏
- –ò–∑–æ–ª—è—Ü–∏—è —Ç–µ—Å—Ç–æ–≤ —á–µ—Ä–µ–∑ –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Å–µ—Å—Å–∏–∏
- Mock —Ä–µ–∂–∏–º –¥–ª—è SMS –∏ –ø–ª–∞—Ç–µ–∂–µ–π

## üöÄ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

```bash
# –í—Å–µ —Ç–µ—Å—Ç—ã
cd backend
poetry run pytest tests/ -v

# –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ñ–∞–π–ª
poetry run pytest tests/test_products.py -v

# –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–µ—Å—Ç
poetry run pytest tests/test_products.py::test_create_product_as_farmer -v

# –° –ø–æ–∫—Ä—ã—Ç–∏–µ–º (–µ—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω pytest-cov)
poetry run pytest tests/ --cov=app --cov-report=html
```

## ‚úÖ –ü–æ–∫—Ä—ã—Ç–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

### –ü—Ä–æ–≤–µ—Ä—è–µ–º—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:

1. **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∏ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞:**
   - ‚úÖ –§–µ—Ä–º–µ—Ä—ã –º–æ–≥—É—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å —Ç–æ–≤–∞—Ä—ã
   - ‚úÖ –ú–∞–≥–∞–∑–∏–Ω—ã –Ω–µ –º–æ–≥—É—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å —Ç–æ–≤–∞—Ä—ã
   - ‚úÖ –ú–∞–≥–∞–∑–∏–Ω—ã –º–æ–≥—É—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –∑–∞–∫–∞–∑—ã
   - ‚úÖ –§–µ—Ä–º–µ—Ä—ã –Ω–µ –º–æ–≥—É—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –∑–∞–∫–∞–∑—ã
   - ‚úÖ –ù–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –æ—Ç–∫–ª–æ–Ω—è—é—Ç—Å—è

2. **–í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö:**
   - ‚úÖ –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–∞
   - ‚úÖ –ù–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ä–µ—Å—É—Ä—Å—ã
   - ‚úÖ –ù–µ–≤–∞–ª–∏–¥–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã —Å—Ç–∞—Ç—É—Å–æ–≤

3. **Mock —Ä–µ–∂–∏–º:**
   - ‚úÖ Mock –ø–ª–∞—Ç–µ–∂–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –¥–ª—è –≤—Å–µ—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤
   - ‚úÖ Dev —Ä–µ–∂–∏–º SMS —Ä–∞–±–æ—Ç–∞–µ—Ç

## üìã –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚úÖ Unit —Ç–µ—Å—Ç—ã –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö endpoints - **–í–´–ü–û–õ–ù–ï–ù–û**
2. üîÑ E2E —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª–Ω–æ–≥–æ flow - **–í –ü–†–û–¶–ï–°–°–ï** (–µ—Å—Ç—å —Å–∫—Ä–∏–ø—Ç—ã)
3. ‚è≥ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
4. ‚è≥ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö
5. ‚è≥ –ü—Ä–æ–≤–µ—Ä–∫–∞ edge cases

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

–°–æ–∑–¥–∞–Ω –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π –Ω–∞–±–æ—Ä unit —Ç–µ—Å—Ç–æ–≤ –¥–ª—è –≤—Å–µ—Ö –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö endpoints backend API. –¢–µ—Å—Ç—ã –ø–æ–∫—Ä—ã–≤–∞—é—Ç:
- –í—Å–µ CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏
- –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –∏ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
- –í–∞–ª–∏–¥–∞—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö
- –û–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫
- Mock —Ä–µ–∂–∏–º—ã

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

